<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="MOES project report">

<title>4&nbsp; Modelling of a heat pump and data reconciliation – Modeling and optimization of energy systems</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04.00-energy_system_integration.html" rel="next">
<link href="./02.00-Heat_recovery.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-6c5e161c8cd73323fda144effafce1d1.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03.00-HP_modeling.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Modelling of a heat pump and data reconciliation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Modelling of a heat pump and data reconciliation</span></h1>
                  <div>
        <div class="description">
          MOES project report
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Modeling and optimization of energy systems</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Abstract</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01.00-Energy_demand.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Energy demand of the EPFL campus</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02.00-Heat_recovery.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">NLP Optimization of Energy Systems</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03.00-HP_modeling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Modelling of a heat pump and data reconciliation</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04.00-energy_system_integration.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Energy system optimization</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-Conclusions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Conclusions</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">4.1</span> Introduction</a></li>
  <li><a href="#degree-of-freedom-dof-analysis" id="toc-degree-of-freedom-dof-analysis" class="nav-link" data-scroll-target="#degree-of-freedom-dof-analysis"><span class="header-section-number">4.2</span> Degree of Freedom (DOF) Analysis</a>
  <ul class="collapse">
  <li><a href="#heat-exchanger-hex" id="toc-heat-exchanger-hex" class="nav-link" data-scroll-target="#heat-exchanger-hex"><span class="header-section-number">4.2.1</span> Heat Exchanger (HEX)</a></li>
  <li><a href="#compressor" id="toc-compressor" class="nav-link" data-scroll-target="#compressor"><span class="header-section-number">4.2.2</span> Compressor</a></li>
  <li><a href="#throttling-valve" id="toc-throttling-valve" class="nav-link" data-scroll-target="#throttling-valve"><span class="header-section-number">4.2.3</span> Throttling Valve</a></li>
  <li><a href="#separator-flash-tank" id="toc-separator-flash-tank" class="nav-link" data-scroll-target="#separator-flash-tank"><span class="header-section-number">4.2.4</span> Separator (Flash Tank)</a></li>
  </ul></li>
  <li><a href="#selection-of-correct-cst-tag-set-in-vali" id="toc-selection-of-correct-cst-tag-set-in-vali" class="nav-link" data-scroll-target="#selection-of-correct-cst-tag-set-in-vali"><span class="header-section-number">4.3</span> Selection of Correct CST Tag Set in VALI</a></li>
  <li><a href="#model-adjustment-to-a-second-working-fluid" id="toc-model-adjustment-to-a-second-working-fluid" class="nav-link" data-scroll-target="#model-adjustment-to-a-second-working-fluid"><span class="header-section-number">4.4</span> Model adjustment to a second working fluid</a></li>
  <li><a href="#data-reconciliation" id="toc-data-reconciliation" class="nav-link" data-scroll-target="#data-reconciliation"><span class="header-section-number">4.5</span> Data reconciliation</a></li>
  <li><a href="#evaluation-of-the-selected-working-fluid" id="toc-evaluation-of-the-selected-working-fluid" class="nav-link" data-scroll-target="#evaluation-of-the-selected-working-fluid"><span class="header-section-number">4.6</span> Evaluation of the Selected Working Fluid</a>
  <ul class="collapse">
  <li><a href="#performance-evaluation" id="toc-performance-evaluation" class="nav-link" data-scroll-target="#performance-evaluation"><span class="header-section-number">4.6.1</span> Performance Evaluation</a></li>
  <li><a href="#investment-costs-evaluation" id="toc-investment-costs-evaluation" class="nav-link" data-scroll-target="#investment-costs-evaluation"><span class="header-section-number">4.6.2</span> Investment costs evaluation</a></li>
  </ul></li>
  <li><a href="#decision-support" id="toc-decision-support" class="nav-link" data-scroll-target="#decision-support"><span class="header-section-number">4.7</span> Decision support</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">4.1</span> Introduction</h2>
<p>The future centralized heating system at EPFL will utilize a two-stage heat pump with an estimated maximum capacity of 6 MW<sub>th</sub>. A two-stage heat pump is an advanced system designed to achieve higher efficiency and greater heating or cooling capacity compared to a single-stage heat pump <span class="citation" data-cites="morisaki2024performance">(<a href="#ref-morisaki2024performance" role="doc-biblioref">Morisaki et al. 2024</a>)</span>. This design is particularly well-suited for applications requiring significant temperature lifts or large capacity adjustments, such as the EPFL campus.</p>
<p>The proposed heat pump model consists of two interconnected thermodynamic cycles, each comprising of the following key processes : an isothermal evaporation, an adiabatic compression, an isothermal condensation and an isentropic expansion.These two cycles are connected via a flash tank, which facilitates intermediate pressure regulation and enhances the system’s efficiency. The second loop ultimately delivers heat to meet the heating demands of the EPFL campus.</p>
<p>The performance will depend on its working fluid. As part of this project, an appropriate working fluid must be selected for the heat pump based on criterisa such as safety, economics, environmental impact, and other relevant properties. To facilitate this, a model of the heat pump is constructed using the process simulation software Belsim VALI.</p>
<div id="fig-hp-model" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-hp-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="Figures/Flowsheet_descriptionpdf.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-hp-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.1: Two-stage heat pump flowsheet in Vali
</figcaption>
</figure>
</div>
<p>This model consists of process units connected by stream flows. Each process unit transforms the stream flow thermo-chemically according to a set of defined equations. The model calculates the state of the outlet flows based on the inlet flows and the unit’s physical properties. These properties are defined by performance parameters, while the simulation includes mass, energy, and momentum balances, along with performance equations.</p>
<p>In terms of stream flows, the Gibbs phase rule asserts that only <span class="math inline">\(N+2\)</span> variables are required to characterize a stream’s state, where <span class="math inline">\(N\)</span> is the number of compounds in the flow, and one of these <span class="math inline">\(N+2\)</span> variables must be extensive (typically the mass flow, <span class="math inline">\(\dot{m}_{\text{WF}}\)</span>). For this analysis, <span class="math inline">\(N\)</span> is assumed to be one, as all flows consist of pure, monophasic fluids.</p>
<hr>
</section>
<section id="degree-of-freedom-dof-analysis" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="degree-of-freedom-dof-analysis"><span class="header-section-number">4.2</span> Degree of Freedom (DOF) Analysis</h2>
<p>The degree of freedom (DOF) represents the number of unknowns that need to be specified to solve the equations within each unit. It is defined as:</p>
<p><span class="math display">\[
\text{DOF} = n_{\text{v}} - n_{\text{e}} = (n_{\text{x}} + n_{\text{p}} + n_{\text{t}}) - (n_{\text{c}} + n_{\text{energy}} + n_{\text{i}} + n_{\text{m}})
\]</span></p>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(n_{\text{v}}\)</span>: Total number of variables</p></li>
<li><p><span class="math inline">\(n_{\text{e}}\)</span>: Total number of equations</p></li>
<li><p><span class="math inline">\(n_{\text{x}}\)</span>: Number of state variables of the streams</p></li>
<li><p><span class="math inline">\(n_{\text{p}}\)</span>: Number of unit parameters</p></li>
<li><p><span class="math inline">\(n_{\text{t}}\)</span>: Number of internal variables</p></li>
<li><p><span class="math inline">\(n_{\text{c}}\)</span>: Number of mass balance equations</p></li>
<li><p><span class="math inline">\(n_{\text{energy}}\)</span>: Number of energy balance equations (typically one)</p></li>
<li><p><span class="math inline">\(n_{\text{i}}\)</span>: Number of impulsion equations</p></li>
<li><p><span class="math inline">\(n_{\text{m}}\)</span>: Number of modelling equations</p></li>
</ul>
<p>If DOF = 0 after setting the <span class="math inline">\(n_{\text{s}}= n_{\text{v}} - n_{\text{e}}\)</span> required parameters, the system of equations can be uniquely solved, enabling the model of the two-stage heat pump to be calculated.</p>
<p>In the VALI model, four main unit types are employed: heat exchangers (HEX), compressors, throttling valves, and separators. Below is the DOF analysis for each unit type.</p>
<section id="heat-exchanger-hex" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="heat-exchanger-hex"><span class="header-section-number">4.2.1</span> Heat Exchanger (HEX)</h3>
<p>For heat exchangers, the pressure drop is assumed equal to zero through the unit.</p>
<p><strong>Variables</strong>:</p>
<ul>
<li><p><span class="math inline">\(T_{\text{in}}\)</span>: Inlet temperature</p></li>
<li><p><span class="math inline">\(P_{\text{in}}\)</span>: Inlet pressure</p></li>
<li><p><span class="math inline">\(\dot{m}_{\text{in}}\)</span>: Inlet mass flow</p></li>
<li><p><span class="math inline">\(T_{\text{out}}\)</span>: Outlet temperature</p></li>
<li><p><span class="math inline">\(P_{\text{out}}\)</span>: Outlet pressure</p></li>
<li><p><span class="math inline">\(\dot{m}_{\text{out}}\)</span>: Outlet mass flow</p></li>
<li><p><span class="math inline">\(\dot{Q}\)</span>: Heat transfer rate</p></li>
</ul>
<p><strong>Equations</strong>:</p>
<ol type="1">
<li><p><span class="math inline">\(\dot{m}_{\text{in}} = \dot{m}_{\text{out}}\)</span> (mass balance)</p></li>
<li><p><span class="math inline">\(P_{\text{in}} = P_{\text{out}}\)</span> (pressure drop constraint)</p></li>
<li><p><span class="math inline">\(\dot{Q} = A_{\text{area}} \cdot U \cdot \text{LMTD}\)</span> (heat transfer, where <span class="math inline">\(A_{\text{area}}\)</span> and <span class="math inline">\(U\)</span> are known design values)</p></li>
<li><p><span class="math inline">\(\dot{Q} = \dot{m}_{\text{WF}} \cdot \Delta h(T, P)\)</span> (energy balance, with <span class="math inline">\(\Delta h\)</span> based on <span class="math inline">\(c_p \cdot \Delta T\)</span> or latent heat <span class="math inline">\(L_p\)</span>, depending on the HEX)</p></li>
</ol>
<p><strong>DOF Calculation</strong>: DOF = 7 (variables) - 4 (equations) = 3.</p>
</section>
<section id="compressor" class="level3" data-number="4.2.2">
<h3 data-number="4.2.2" class="anchored" data-anchor-id="compressor"><span class="header-section-number">4.2.2</span> Compressor</h3>
<p>The compressor model is based on isentropic efficiency, as specified in the VALI documentation.</p>
<p><strong>Variables</strong>:</p>
<ul>
<li><p><span class="math inline">\(T_{\text{in}}\)</span>: Inlet temperature</p></li>
<li><p><span class="math inline">\(P_{\text{in}}\)</span>: Inlet pressure</p></li>
<li><p><span class="math inline">\(\dot{m}_{\text{in}}\)</span>: Inlet mass flow</p></li>
<li><p><span class="math inline">\(T_{\text{out}}\)</span>: Outlet temperature</p></li>
<li><p><span class="math inline">\(P_{\text{out}}\)</span>: Outlet pressure</p></li>
<li><p><span class="math inline">\(T^{is}_{\text{out}}\)</span>: Outlet temperature (isentropic transformation)</p></li>
<li><p><span class="math inline">\(\dot{m}_{\text{out}}\)</span>: Outlet mass flow</p></li>
<li><p><span class="math inline">\(W\)</span>: Work input</p></li>
<li><p><span class="math inline">\(W_{\text{is}}\)</span>: Isentropic work input</p></li>
<li><p><span class="math inline">\(\eta_{\text{is}}\)</span>: Isentropic efficiency</p></li>
</ul>
<p><strong>Equations</strong>:</p>
<ol type="1">
<li><p><span class="math inline">\(\dot{m}_{\text{in}} = \dot{m}_{\text{out}}\)</span> (mass balance)</p></li>
<li><p><span class="math inline">\(\dot{Q} = \dot{m}_{\text{WF}} \cdot c_p \cdot \Delta T\)</span> (energy balance)</p></li>
<li><p><span class="math inline">\(W = \dot{m} \cdot (h_{\text{out}} - h_{\text{in}})\)</span> (work calculation)</p></li>
<li><p><span class="math inline">\(W = W_{\text{is}} \cdot \eta_{\text{is}}\)</span> (isentropic efficiency relation)</p></li>
<li><p><span class="math inline">\(\frac{T^{is}_{\text{out}}}{T_{\text{in}}} = \left(\frac{P_{\text{out}}}{P_{\text{in}}}\right)^{\frac{\gamma - 1}{\gamma}}\)</span> (isentropic relation)</p></li>
<li><p><span class="math inline">\(s(T_{\text{in}}, P_{\text{in}}) = s(T^{is}_{\text{out}}, P_{\text{out}})\)</span> (isentropic constraint)</p></li>
</ol>
<p><strong>DOF Calculation</strong>: DOF = 10 (variables) - 6 (equations) = 4.</p>
</section>
<section id="throttling-valve" class="level3" data-number="4.2.3">
<h3 data-number="4.2.3" class="anchored" data-anchor-id="throttling-valve"><span class="header-section-number">4.2.3</span> Throttling Valve</h3>
<p>For throttling valves, a constant enthalpy (isenthalpic) process with no pressure drop is assumed.</p>
<p><strong>Variables</strong>:</p>
<ul>
<li><p><span class="math inline">\(T_{\text{in}}\)</span>: Inlet temperature</p></li>
<li><p><span class="math inline">\(P_{\text{in}}\)</span>: Inlet pressure</p></li>
<li><p><span class="math inline">\(\dot{m}_{\text{in}}\)</span>: Inlet mass flow</p></li>
<li><p><span class="math inline">\(T_{\text{out}}\)</span>: Outlet temperature</p></li>
<li><p><span class="math inline">\(P_{\text{out}}\)</span>: Outlet pressure</p></li>
<li><p><span class="math inline">\(\dot{m}_{\text{out}}\)</span>: Outlet mass flow</p></li>
</ul>
<p><strong>Equations</strong>:</p>
<ol type="1">
<li><p><span class="math inline">\(\dot{m}_{\text{in}} = \dot{m}_{\text{out}}\)</span> (mass balance)</p></li>
<li><p><span class="math inline">\(P_{\text{in}} = P_{\text{out}}\)</span> (pressure drop constraint)</p></li>
</ol>
<p><strong>DOF Calculation</strong>: DOF = 6 (variables) - 2 (equations) = 4.</p>
</section>
<section id="separator-flash-tank" class="level3" data-number="4.2.4">
<h3 data-number="4.2.4" class="anchored" data-anchor-id="separator-flash-tank"><span class="header-section-number">4.2.4</span> Separator (Flash Tank)</h3>
<p>Similarly to heat exchangers, the pressure drop is also assumed to be zero across the separator (flash tank). Considering that there are two flows at the inlet and two flows at the outlet, the subscript <span class="math inline">\(i =1,2\)</span> is used.</p>
<p><strong>Variables</strong>:</p>
<ul>
<li><p><span class="math inline">\(T_{i,\text{in}}\)</span>: Inlet temperature</p></li>
<li><p><span class="math inline">\(P_{i,\text{in}}\)</span>: Inlet pressure</p></li>
<li><p><span class="math inline">\(\dot{m}_{i,\text{in}}\)</span>: Inlet mass flow</p></li>
<li><p><span class="math inline">\(T_{i,\text{out}}\)</span>: Outlet temperature</p></li>
<li><p><span class="math inline">\(P_{i,\text{out}}\)</span>: Outlet pressure</p></li>
<li><p><span class="math inline">\(\dot{m}_{i,\text{out}}\)</span>: Outlet mass flow</p></li>
<li><p><span class="math inline">\(\dot{Q}\)</span>: Heat flow</p></li>
</ul>
<p><strong>Equations</strong>:</p>
<ol type="1">
<li><p><span class="math inline">\(\dot{m}_{i,\text{in}} = \dot{m}_{i,\text{out}}\)</span> (mass balance, 2 equations)</p></li>
<li><p><span class="math inline">\(P_{i,\text{in}} = P_{i,\text{out}}\)</span> (pressure drop constraint, 2 equations)</p></li>
<li><p><span class="math inline">\(\sum \dot{m}_{i,\text{in}} \cdot h(T_{i,\text{in}}, P_{i,\text{in}}) = \sum \dot{m}_{i,\text{out}} \cdot h(T_{i,\text{out}}, P_{i,\text{out}})\)</span> (energy balance)</p></li>
</ol>
<p><strong>DOF Calculation</strong>: DOF = 12 (variables) - 5 (equations) = 7.</p>
<hr>
</section>
</section>
<section id="selection-of-correct-cst-tag-set-in-vali" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="selection-of-correct-cst-tag-set-in-vali"><span class="header-section-number">4.3</span> Selection of Correct CST Tag Set in VALI</h2>
<p>Using the DOF analysis, the correct CST tag configuration is identified in VALI. This ensures that no system is overspecified (CST) or underspecified (OFF) within the simulation. From five possible CST tag configurations given in <a href="#tbl-dof" class="quarto-xref">Table&nbsp;<span>4.1</span></a>, only one is correct and is determined by analyzing each unit’s DOF and requirements.</p>
<div class="cell">
<div id="tbl-dof" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-dof-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.1: Various Tag configuation options
</figcaption>
<div aria-describedby="tbl-dof-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Various Tag configuation options</caption>
<colgroup>
<col style="width: 31%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Tag Name</th>
<th style="text-align: left;">Unit</th>
<th style="text-align: left;">Option 1</th>
<th style="text-align: left;">Option 2</th>
<th style="text-align: left;">Option 3</th>
<th style="text-align: left;">Option 4</th>
<th style="text-align: left;">Option 5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">HP_COMP1_EFFIC</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="even">
<td style="text-align: left;">HP_COMP1_PRATIO</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HP_FLASH_DP</td>
<td style="text-align: left;">bar</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="even">
<td style="text-align: left;">HP_COMP2_EFFIC</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HP_COND_LATENT_DP</td>
<td style="text-align: left;">bar</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">HP_EVAP_DP</td>
<td style="text-align: left;">bar</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">COP_REAL</td>
<td style="text-align: left;">-</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="even">
<td style="text-align: left;">HP_COND_SENSIBLE_DP</td>
<td style="text-align: left;">bar</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EPFL_COND_SENSIBLE_DP1</td>
<td style="text-align: left;">bar</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">EPFL_COND_LATENT_DP1</td>
<td style="text-align: left;">bar</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q_COND_LOAD</td>
<td style="text-align: left;">kW</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="even">
<td style="text-align: left;">DELTAT_MIN_VAR1</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">MAX_MASSF_HP2</td>
<td style="text-align: left;">kg/s</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">MAX_MASSF_HP6</td>
<td style="text-align: left;">kg/s</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HP2_T</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">HP2_MASSF</td>
<td style="text-align: left;">kg/s</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="odd">
<td style="text-align: left;">W_HP_COMP1_POWER</td>
<td style="text-align: left;">kW</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">W_HP_COMP2_POWER</td>
<td style="text-align: left;">kW</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HP5_T</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="even">
<td style="text-align: left;">HP5BIS_T</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="odd">
<td style="text-align: left;">HP6_T</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">HP6_MASSF</td>
<td style="text-align: left;">kg/s</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q_COND_LATENT_LOAD</td>
<td style="text-align: left;">kW</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">HP1_T</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Q_EVAP_LOAD</td>
<td style="text-align: left;">kW</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="even">
<td style="text-align: left;">Q_COND_SENSIBLE_LOAD</td>
<td style="text-align: left;">kW</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EPFL_OUTBIS_P</td>
<td style="text-align: left;">bar</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">EPFL_OUTBIS_T</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EPFL_IN_P</td>
<td style="text-align: left;">bar</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">EPFL_IN_T</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EPFL_OUT_P</td>
<td style="text-align: left;">bar</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="even">
<td style="text-align: left;">EPFL_OUT_T</td>
<td style="text-align: left;">C</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
</tr>
<tr class="odd">
<td style="text-align: left;">EPFL_OUT_MASSF</td>
<td style="text-align: left;">kg/s</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">OFF</td>
<td style="text-align: left;">CST</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<ol type="1">
<li><strong>Option 1</strong> is not valid as it would lead to an overconstraint on <code>EPFL_COND_SENSIBLE</code> as DOF = 3 but 4 values are known [<code>EPFL_OUT</code> (P and T), <code>EPFL_OUTBIS_T</code> and <code>q_cond_sensible_load</code>].</li>
<li><strong>Option 2</strong> is not valid as it would lead to an overconstraint on <code>EPFL_COND_LATENT</code> as DOF = 3 but 4 values are known [<code>EPFL_OUT</code> (P,T and <span class="math inline">\(\dot{m}\)</span>) and <code>q_cond_latent_load</code>].</li>
<li><strong>Option 3</strong> is not valid as it lacks one constraint (remainder DOF = 1) to fully assess the variable on the <code>HP_cond</code> between <code>hp5</code> and <code>hp6</code>.</li>
<li><strong>Option 4</strong> seems to be the valid option as it enables to derive all variables of this defined problem. Of course, consistent values need to be implemented for each point as some interconnected units have CST tags on related variables. As an example, the pressure drops for all the units of the EPFL loop are set to CST (<code>HP_COND_LATENT_DP</code>, <code>HP_COND_SENSIBLE_DP</code>,<code>EPFL_COND_SENSIBLE_DP1</code>, <code>EPFL_COND_LATENT_DP1</code>) and so are the pressures within the loop (<code>EPFL_OUT_P</code>, <code>EPFL_OUTBIS_P,EPFL_IN_P</code>).</li>
<li><strong>Option 5</strong> is not valid as defining no state variables (T and P) induces a lack of constraint. For instance, <code>HP_vap</code> only gets <code>q_evap_load</code> as a specification.</li>
</ol>
<p>Consequently, <strong>Option 4</strong> will be selected in the VALI model, enabling an analysis of the working fluids under the specified constraints.</p>
</section>
<section id="model-adjustment-to-a-second-working-fluid" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="model-adjustment-to-a-second-working-fluid"><span class="header-section-number">4.4</span> Model adjustment to a second working fluid</h2>
<p>First, the reference working fluid <strong>R-290</strong> (propane) is selected for its favourable balance of performance and environmental impact. With a Global Warming Potential (GWP) of 3.3, R-290 has a relatively low contribution to climate change compared to many other refrigerants. However, its primary drawback lies in its flammability, which raises safety concerns that must be carefully managed. Despite this limitation, R-290 is widely used in large-scale systems due to its excellent thermodynamic properties and cost-effectiveness <span class="citation" data-cites="nawaz2017r290">(<a href="#ref-nawaz2017r290" role="doc-biblioref">Nawaz et al. 2017</a>)</span>.</p>
<p>For comparison, the second fluid considered is Tetrafluoropropene (<strong>R-1234yf</strong>). This fluid offers a low GWP of 4, making it an environmentally sustainable alternative. With an atmospheric lifetime of just 0.03 years and zero ozone depletion potential, R-1234yf minimizes its long-term environmental impact. In terms of safety, R-1234yf belongs to the A2L safety classification: “A” indicates low toxicity, “2” signifies lower flammability, and “L” designates a slow-burning subcategory <span class="citation" data-cites="toxicity">(<a href="#ref-toxicity" role="doc-biblioref">UNEP/ASHRAE 2022</a>)</span>. These properties make it an appealing option for applications prioritizing environmental compliance and safety. However, higher operating costs are expected using R1234yf compared to other working fluids <span class="citation" data-cites="garcia2021review">(<a href="#ref-garcia2021review" role="doc-biblioref">Garcı́a-Pabón et al. 2021</a>)</span>.</p>
</section>
<section id="data-reconciliation" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="data-reconciliation"><span class="header-section-number">4.5</span> Data reconciliation</h2>
<p>For both working fluids, computing this two-stage heat pump system will inevitably lead to inaccuracy. All reference values provided to the model are derived from observations of physical properties, which carry margins of error. Generally, two types of errors are considered:</p>
<ul>
<li><strong>Systematic errors</strong>: These arise from a consistent offset in measurements, typically stemming from instrument bias or dependencies on identifiable quantities.</li>
<li><strong>Random errors</strong>: These represent variability in repeated measurements that cannot be predicted from prior readings and are often due to sensor noise or natural fluctuations.</li>
</ul>
<p>While random errors may be minimized with filtering, systematic errors require multiple measurements to estimate and adjust for offsets.</p>
<p>Data reconciliation is necessary to ensure that deviations in systematic measurements do not lead to violations of mass or energy conservation laws. By leveraging redundant measurements in the model, data reconciliation minimizes the difference between observed and expected values, effectively solving a constrained nonlinear optimization problem:</p>
<p><span class="math display">\[
\min_{X, Y} \sum_{i=1}^{n_{\text{mes}}} \left( \frac{y_i - y_i^*}{\sigma_i} \right)^2
\]</span></p>
<p>subject to:</p>
<ul>
<li>Mass Balance <span class="math inline">\((X, Y) = 0\)</span></li>
<li>Energy Balance <span class="math inline">\((X, Y) = 0\)</span></li>
<li>Thermodynamic <span class="math inline">\((X, Y) = 0\)</span></li>
<li>Constitutive Equations <span class="math inline">\((X, Y) = 0\)</span></li>
<li>Performance <span class="math inline">\((X, Y, \pi) = 0\)</span></li>
<li>Inequalities <span class="math inline">\((X, Y) = 0\)</span></li>
</ul>
<p>where:</p>
<ul>
<li><p><span class="math inline">\(y_i\)</span> is a state variable value,</p></li>
<li><p><span class="math inline">\(y_i^*\)</span> is the measured value,</p></li>
<li><p><span class="math inline">\(\sigma_i\)</span> is the standard deviation of the measurement.</p></li>
</ul>
<p>In this problem, <span class="math inline">\(X\)</span> represents the state variables to estimate (i.e., non-measured), and <span class="math inline">\(Y\)</span> represents the measured state variables. The constraints derive from system knowledge or virtual sensors, forming a system of modeling and specification equations <span class="math inline">\(F(X, Y) = 0\)</span>.</p>
<p>Measurements for different time periods (6 to 11) and two temperature levels (low and medium temperature) allow for effective data reconciliation within VALI, providing corrected results for ongoing analysis.</p>
</section>
<section id="evaluation-of-the-selected-working-fluid" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="evaluation-of-the-selected-working-fluid"><span class="header-section-number">4.6</span> Evaluation of the Selected Working Fluid</h2>
<p>With reconciled data for the two chosen working fluids, a thorough analysis is conducted to aid decision-making. Key parameters for evaluation include thermodynamic performance and investment cost.</p>
<section id="performance-evaluation" class="level3" data-number="4.6.1">
<h3 data-number="4.6.1" class="anchored" data-anchor-id="performance-evaluation"><span class="header-section-number">4.6.1</span> Performance Evaluation</h3>
<p>The <strong>Coefficient of Performance (COP)</strong> measures the heat pump’s thermodynamic performance, defined as:</p>
<p><span id="eq-COP"><span class="math display">\[
\text{COP}(t) = \frac{Q(t)}{W(t)}
\tag{4.1}\]</span></span></p>
<p>where <span class="math inline">\(Q\)</span> is the useful heat produced, and <span class="math inline">\(W\)</span> is the energy input.</p>
<p>To assess COP’s variation with ambient temperature, <span class="math inline">\(T_{\text{ext}}(t)\)</span>, we derive a regression model for the <strong>Carnot factor</strong>:</p>
<p><span id="eq-Carnot-factor"><span class="math display">\[
C_{\text{Carnot}}(t) = \frac{\text{COP}(t)}{\text{COP}_{\text{Carnot}}(t)} = \frac{Q(t)}{W(t)} \cdot \frac{T_{\text{cond}}(t) - T_{\text{evap}}(t)}{T_{\text{cond}}(t)}
\tag{4.2}\]</span></span></p>
<p>where <span class="math inline">\(T_{\text{cond}}(t)\)</span> and <span class="math inline">\(T_{\text{evap}}(t)\)</span> are the heat sink and heat source temperatures (in Kelvin), respectively.</p>
<p>An AMPL model is used to fit a polynomial regression curve for the Carnot factor based solely on the ambient temperature <span class="math inline">\(T_{\text{ext}}(t)\)</span>:</p>
<p><span id="eq-regression-model"><span class="math display">\[
C_{\text{Carnot}}^*(t) = a \cdot T_{\text{ext}}^2(t) - b \cdot T_{\text{ext}}(t) + c
\tag{4.3}\]</span></span></p>
<p>The coefficients <span class="math inline">\(a\)</span>, <span class="math inline">\(b\)</span>, and <span class="math inline">\(c\)</span> are obtained by minimizing the mean square error:</p>
<p><span id="eq-min-abc"><span class="math display">\[
\min_{a, b, c} \sum_t \left( C_{\text{Carnot}}^*(t) - C_{\text{Carnot}}(t) \right)^2
\tag{4.4}\]</span></span></p>
<p>This regression (<a href="#eq-regression-model" class="quarto-xref">Equation&nbsp;<span>4.3</span></a>) captures operational efficiency, environmental conditions, and theoretical limits, while remaining valid only within the ambient temperature range 2.2°C to 15°C. Although a higher-order polynomial might offer improved precision, it could lead to overfitting due to limited data points.</p>
<p>This analysis is performed for each working fluid at both low and medium temperature levels. The regression coefficients are presented in <a href="#tbl-coefficients" class="quarto-xref">Table&nbsp;<span>4.2</span></a>, and the Carnot factor is plotted against ambient temperature in <a href="#fig-fluids" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>.</p>
<div class="cell">
<div id="tbl-coefficients" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-coefficients-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.2: Regression Coefficients for Carnot Factor
</figcaption>
<div aria-describedby="tbl-coefficients-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Regression Coefficients for Carnot Factor</caption>
<colgroup>
<col style="width: 17%">
<col style="width: 22%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 11%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Working Fluid</th>
<th style="text-align: left;">Temperature Level</th>
<th style="text-align: left;">a</th>
<th style="text-align: left;">b</th>
<th style="text-align: left;">c</th>
<th style="text-align: left;">Error Estimation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">R-290</td>
<td style="text-align: left;">LT</td>
<td style="text-align: left;">1e-06</td>
<td style="text-align: left;">1e-06</td>
<td style="text-align: left;">0.398965</td>
<td style="text-align: left;">0.195492</td>
</tr>
<tr class="even">
<td style="text-align: left;">R-290</td>
<td style="text-align: left;">MT</td>
<td style="text-align: left;">0.000111965</td>
<td style="text-align: left;">1e-06</td>
<td style="text-align: left;">0.376003</td>
<td style="text-align: left;">0.0707854</td>
</tr>
<tr class="odd">
<td style="text-align: left;">R-1234yf</td>
<td style="text-align: left;">LT</td>
<td style="text-align: left;">0.000196424</td>
<td style="text-align: left;">0.00513117</td>
<td style="text-align: left;">0.123403</td>
<td style="text-align: left;">0.00251004</td>
</tr>
<tr class="even">
<td style="text-align: left;">R-1234yf</td>
<td style="text-align: left;">MT</td>
<td style="text-align: left;">1e-06</td>
<td style="text-align: left;">0.00758805</td>
<td style="text-align: left;">0.12301</td>
<td style="text-align: left;">0.0064256</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
<div id="fig-fluids" class="quarto-float quarto-figure quarto-figure-center anchored" style="text-align: center;">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-fluids-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th><img src="Figures/r290_lt.png" class="img-fluid figure-img" style="width:100.0%"></th>
<th><img src="Figures/r290_mt.png" class="img-fluid figure-img" style="width:100.0%"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><img src="Figures/r1234yf_lt.png" class="img-fluid figure-img" style="width:100.0%"></td>
<td><img src="Figures/r1234yf_mt.png" class="img-fluid figure-img" style="width:100.0%"></td>
</tr>
</tbody>
</table>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-fluids-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4.2: Regressions of the Carnot Factors for R-290 and R-1234yf under LT and MT conditions. R-290 is shown in the upper panels (LT on the left, MT on the right), and R-1234yf is in the lower panels (LT on the left, MT on the right).
</figcaption>
</figure>
</div>
</section>
<section id="investment-costs-evaluation" class="level3" data-number="4.6.2">
<h3 data-number="4.6.2" class="anchored" data-anchor-id="investment-costs-evaluation"><span class="header-section-number">4.6.2</span> Investment costs evaluation</h3>
<p>The investment cost for the heat pump primarily stems from the heat exchangers and compressors. To evaluate this economic impact, the unit cost of the two-stage heat pump is calculated, accounting for the size of both components.</p>
<p>The area of heat exchangers is determined under worst-case conditions, which then defines the compressor size. With reconciled results and ambient temperatures, the size of these units enables cost estimation.</p>
<p>On the one hand, the heat exchanger includes both a condenser and an evaporator, allowing us to separate its total cost into two components:</p>
<p><span id="eq-C-HEX"><span class="math display">\[
C_{\text{HEX}} = C_{\text{condenser}} + C_{\text{evaporator}}
\tag{4.5}\]</span></span></p>
<p>For both heat exchangers the cost is evaluated based on the area needed for the heat exchanger. The equation for the cost is the following:</p>
<ul>
<li><p>Condensator: Cost = <span class="math inline">\(10^{k_1 + k_2 *\log_{10}(A_{cond}) + k_3*( \log_{10}(A_{cond}) )^2} \cdot \frac{I}{I_{ref}} \cdot f_{BM}\)</span></p></li>
<li><p>Evaporator: Cost = <span class="math inline">\(10^{k_1 + k_2 *\log_{10}(A_{evap}) + k_3*( \log_{10}(A_{evap}) )^2} \cdot \frac{I}{I_{ref}} \cdot f_{BM}\)</span></p></li>
</ul>
<p>where <span class="citation" data-cites="condensatorvariables">(<a href="#ref-condensatorvariables" role="doc-biblioref">Ali 2013</a>)</span>:</p>
<ul>
<li><p><span class="math inline">\(k_i\)</span> are empirical constants,</p></li>
<li><p><span class="math inline">\(A\)</span> is the heat transfer are of the unit,</p></li>
<li><p><span class="math inline">\(I\)</span> is the cost index.</p></li>
<li><p><span class="math inline">\(I_{ref}\)</span> is the reference cost index corresponding to the time when the <span class="math inline">\(k_i\)</span> were determined.</p></li>
<li><p><span class="math inline">\(f_{BM}\)</span> is the bare module factor.</p></li>
</ul>
<p>On the other hand, the system includes two compressors, so the total compressor cost can be expressed as:</p>
<p><span id="eq-C-comp"><span class="math display">\[
C_{\text{compressor}} = C_{\text{compressor1}} + C_{\text{compressor2}}
\tag{4.6}\]</span></span></p>
<p>The cost for the compressors is given by the formula:</p>
<p>Cost = <span class="math inline">\(10^{k_1 + k_2 *\log_{10}(W_{max}) + k_3*( \log_{10}(W_{max}) )^2} \cdot \frac{I}{I_{ref}} \cdot f_{BM}\)</span></p>
<p>where <span class="math inline">\(W_{max}\)</span> is the power needed by the compressor during the extreme period.</p>
<p>The total cost of the heat pump system is then defined as:</p>
<p><span id="eq-C-HP"><span class="math display">\[
C_{\text{HP}} = C_{\text{HEX}} + C_{\text{compressor}}
\tag{4.7}\]</span></span></p>
<p>Finally, the unit cost of the system can be determined based on the installed heat pump capacity:</p>
<p><span id="eq-C-HP-kW"><span class="math display">\[
c_{\text{HP}} = \frac{C_{\text{HP}}}{Q_{\text{HP}}} \quad [\text{CHF/kW}]
\tag{4.8}\]</span></span></p>
<p><a href="#tbl-costs" class="quarto-xref">Table&nbsp;<span>4.3</span></a> lists the worst-case conditions that determine the system’s total cost.</p>
<div class="cell">
<div id="tbl-costs" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-costs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4.3: Cost Estimation for the Heat Pump System
</figcaption>
<div aria-describedby="tbl-costs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="do-not-create-environment cell caption-top table table-sm table-striped small">
<caption>Cost Estimation for the Heat Pump System</caption>
<colgroup>
<col style="width: 39%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 17%">
<col style="width: 17%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameters</th>
<th style="text-align: right;">R-290 LT</th>
<th style="text-align: right;">R-290 MT</th>
<th style="text-align: right;">R-1234yf LT</th>
<th style="text-align: right;">R-1234yf MT</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Condenser Area [m2]</td>
<td style="text-align: right;">636</td>
<td style="text-align: right;">1432</td>
<td style="text-align: right;">1374</td>
<td style="text-align: right;">1621</td>
</tr>
<tr class="even">
<td style="text-align: left;">Evaporator Area [m2]</td>
<td style="text-align: right;">1306</td>
<td style="text-align: right;">1359</td>
<td style="text-align: right;">1015</td>
<td style="text-align: right;">703</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cost HEX [CHF]</td>
<td style="text-align: right;">1799373</td>
<td style="text-align: right;">2618830</td>
<td style="text-align: right;">2205921</td>
<td style="text-align: right;">2194472</td>
</tr>
<tr class="even">
<td style="text-align: left;">Cost Compressor 1 [CHF]</td>
<td style="text-align: right;">572195</td>
<td style="text-align: right;">619408</td>
<td style="text-align: right;">637552</td>
<td style="text-align: right;">795136</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Cost Compressor 2 [CHF]</td>
<td style="text-align: right;">692000</td>
<td style="text-align: right;">771960</td>
<td style="text-align: right;">1058090</td>
<td style="text-align: right;">1480810</td>
</tr>
<tr class="even">
<td style="text-align: left;">Compressors Cost [CHF]</td>
<td style="text-align: right;">1264195</td>
<td style="text-align: right;">1393368</td>
<td style="text-align: right;">1695642</td>
<td style="text-align: right;">22759467</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Total Heat Pump Cost [CHF]</td>
<td style="text-align: right;">2864568</td>
<td style="text-align: right;">4000198</td>
<td style="text-align: right;">3890563</td>
<td style="text-align: right;">4470418</td>
</tr>
<tr class="even">
<td style="text-align: left;">Unit Cost per kW [CHF/kW]</td>
<td style="text-align: right;">520</td>
<td style="text-align: right;">664</td>
<td style="text-align: right;">760</td>
<td style="text-align: right;">715</td>
</tr>
</tbody>
</table>
</div>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="decision-support" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="decision-support"><span class="header-section-number">4.7</span> Decision support</h2>
<p>Now that the key parameters have been estimated, the two working fluids—R-290 and R-1234yf—can be thoroughly compared to determine the most suitable choice for EPFL’s new two-stage heat pump system.</p>
<p>As illustrated in <a href="#fig-fluids" class="quarto-xref">Figure&nbsp;<span>4.2</span></a>, R-290 demonstrates superior thermodynamic performance within the analysed range, achieving higher efficiency across varying ambient temperatures compared to R-1234yf. Economically, R-290 also proves to be the more cost-effective solution under worst-case conditions, providing substantial savings in operating costs.</p>
<p>However, it is essential to consider the environmental and safety trade-offs. R-1234yf has an exceptionally short atmospheric lifetime of 0.03 years compared to R-290, which lingers for approximately 12 years—making the former nearly 400 times less persistent in the atmosphere. Additionally, R-1234yf is classified as a low-flammability refrigerant (A2L), offering a safer alternative, whereas R-290 poses higher flammability risks that must be addressed. However, R-290 offers the lowest GWP of the two working fluids.</p>
<p>Given this analysis, R-290 is recommended for EPFL’s new two-stage heat pump. While it presents some challenges in terms of flammability and atmospheric persistence, its superior thermodynamic and economic performance makes it a highly viable option. With robust safety measures in place to mitigate potential hazards, R-290 can reliably and efficiently support the campus’s heating needs while aligning with cost-saving objectives.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-condensatorvariables" class="csl-entry" role="listitem">
Ali, Chaudhry Hassan. 2013. <span>“Capital Cost Estimation Chapter 5.”</span> 2013. <a href="https://fr.slideshare.net/slideshow/chapter-5-17550956/17550956">https://fr.slideshare.net/slideshow/chapter-5-17550956/17550956</a>.
</div>
<div id="ref-garcia2021review" class="csl-entry" role="listitem">
Garcı́a-Pabón, Juan J, Dario Méndez-Méndez, Juan M Belman-Flores, Juan M Barroso-Maldonado, and Ali Khosravi. 2021. <span>“A Review of Recent Research on the Use of R1234yf as an Environmentally Friendly Fluid in the Organic Rankine Cycle.”</span> <em>Sustainability</em> 13 (11): 5864.
</div>
<div id="ref-morisaki2024performance" class="csl-entry" role="listitem">
Morisaki, Takafumi, Junichi Ohara, Takeshi Yasunaga, and Yasuyuki Ikegami. 2024. <span>“Performance Analysis of Double-Stage Heat Pump and Refrigeration Cycles.”</span> <em>Applied Thermal Engineering</em>, 123732.
</div>
<div id="ref-nawaz2017r290" class="csl-entry" role="listitem">
Nawaz, Kashif, Bo Shen, Ahmed Elatar, Van Baxter, and Omar Abdelaziz. 2017. <span>“R290 (Propane) and R600a (Isobutane) as Natural Refrigerants for Residential Heat Pump Water Heaters.”</span> <em>Applied Thermal Engineering</em> 127: 870–83.
</div>
<div id="ref-toxicity" class="csl-entry" role="listitem">
UNEP/ASHRAE. 2022. <span>“Update on New Refrigerants Designations and Safety Classifications.”</span> 2022. <a href="https://www.ashrae.org/file%20library/technical%20resources/bookstore/factsheet_ashrae_english_november2022.pdf">https://www.ashrae.org/file%20library/technical%20resources/bookstore/factsheet_ashrae_english_november2022.pdf</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02.00-Heat_recovery.html" class="pagination-link" aria-label="NLP Optimization of Energy Systems">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">NLP Optimization of Energy Systems</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04.00-energy_system_integration.html" class="pagination-link" aria-label="Energy system optimization">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Energy system optimization</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>